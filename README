PMIC-based A/B boot switcher for Gen3
=====================================

Apply ATF patches in atf-patches/ to ATF 2.4 and update ATF,
otherwise ATF would disable RWDT and won't load from correct
offsets.

The HF layout is as follows:
0x000000 - bootparam.sa0 from this repository
0x040000 - A-copy ATF BL2 ( build/rcar/release/bl2.bin )
0x080000 - jump.bin from this repository
0x180000 - A-copy ATF SA6 ( tools/renesas/rcar_layout_create/cert_header_sa6.bin )
0x1c0000 - A-copy ATF BL31 ( build/rcar/release/bl31.bin )
0x200000 - A-copy OpTee OS ( out/arm-plat-rcar/core/tee-pager_v2.bin )
0x640000 - A-copy U-Boot ( u-boot.bin )
0x800000 - Flash writer ( AArch64_Flash_writer_SCIF_DUMMY_CERT_E6300400_salvator-x.bin )
0x840000 - B-copy ATF BL2 ( build/rcar/release/bl2.bin )
0x980000 - B-copy ATF SA6 ( tools/renesas/rcar_layout_create/cert_header_sa6.bin )
0x9c0000 - B-copy ATF BL31 ( build/rcar/release/bl31.bin )
0xa00000 - B-copy OpTee OS ( out/arm-plat-rcar/core/tee-pager_v2.bin )
0xe40000 - B-copy U-Boot ( u-boot.bin )

Compile:
$ make
Install the resulting update.itb on board:
=> dfu tftp <address>

Check which option is booted:
=> i2c dev 7 && i2c md 0x30 0x70 2
Setting bus to 7
0070: a5 01    ..
# a5 is magic, 00 is A-copy / 01 is B-copy

Boot A-copy
=> i2c dev 7 && i2c mw 0x30 0x70 0xa5 && i2c mw 0x30 0x71 0 ; reset

Boot B-copy
=> i2c dev 7 && i2c mw 0x30 0x70 0xa5 && i2c mw 0x30 0x71 1 ; reset

Boot flash-writer
=> i2c dev 7 && i2c mw 0x30 0x70 0xa5 && i2c mw 0x30 0x71 3 ; reset
